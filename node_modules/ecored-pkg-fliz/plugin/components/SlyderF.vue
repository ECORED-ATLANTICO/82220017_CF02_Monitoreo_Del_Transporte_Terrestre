<template lang="pug">

  .slyder-f
    .slyder-f__btn.pe-3(
      @click="clickAnterior"
      :class="{ 'is-disabled': isFirst }"
    )
      i.fas.fa-chevron-left
  
    .slyder-f__main(:id="'slyder-f-' + mainId")
      ScrollHorizontal(
        v-if="elements.length && rendered" 
        :selectedId="'sl-' + selected"
        row
      )
        .slyder-f__slyde(
          v-for="(item, index) in elements"
          :key="'sl-key-'+item.id"
          :id="'sl-'+item.id"
          :class="columnas"
          v-child="item.elm"
        )
  
    .slyder-f__btn.ps-3(
      @click="clickSiguiente"
      :class="{ 'is-disabled': isLast }"
    )
      i.fas.fa-chevron-right
  
    .hidden-slot
      slot
  </template>

<script>
import ScrollHorizontal from './ScrollHorizontal'
import componentSlotMixins from './componentSlotMixins'
import slyderMixins from './slyderMixins'
export default {
  name: 'SlyderF',
  components: { ScrollHorizontal },
  mixins: [componentSlotMixins, slyderMixins],
  props: {
    columnas: {
      type: String,
      default: '',
    },
  },
  computed: {
    isFirst() {
      if (!this.elements.length) return true
      return this.selected === this.elements[0].id
    },
    isLast() {
      if (!this.elements.length) return true
      //const visibleCount = this.getVisibleCardsCount()
      const visibles = this.getVisibleSlides()
      console.log('visibles', visibles)

      const ids = this.elements.map(e => e.id)
      const idx = ids.indexOf(this.selected)
      return idx >= ids.length - visibles
    },
  },
  methods: {
    clickAnterior() {
      const ids = this.elements.map(element => element.id)
      const idxOfSelected = ids.indexOf(this.selected)
      if (idxOfSelected > 0) {
        this.selected = ids[idxOfSelected - 1]
      }
    },
    clickSiguiente() {
      if (this.isLast) return
      const ids = this.elements.map(e => e.id)
      const idx = ids.indexOf(this.selected)
      if (idx < ids.length - 1) {
        this.selected = ids[idx + 1]
      }
    },
    getVisibleCardsCount() {
      const width = window.innerWidth
      // Simula Bootstrap: xl ≥ 1200px, lg ≥ 992px
      if (width >= 1200) return 3 // col-xl-3
      if (width >= 992) return 2 // col-lg-4
      if (width >= 768) return 2 // supongamos col-md-6
      return 1 // móviles
    },
    getVisibleSlides() {
      const clases = this.columnas.split(' ')
      let cols = 12 // valor por defecto

      // Definir breakpoints de Bootstrap
      const width = window.innerWidth
      let claseActiva = null

      // Buscar la clase más específica según el ancho
      if (width >= 1200) {
        claseActiva = clases.find(c => c.startsWith('col-xl-'))
      }
      if (!claseActiva && width >= 992) {
        claseActiva = clases.find(c => c.startsWith('col-lg-'))
      }
      if (!claseActiva && width >= 768) {
        claseActiva = clases.find(c => c.startsWith('col-md-'))
      }
      if (!claseActiva && width >= 576) {
        claseActiva = clases.find(c => c.startsWith('col-sm-'))
      }
      if (!claseActiva) {
        claseActiva = clases.find(
          c => c.startsWith('col-') && !c.match(/col-(sm|md|lg|xl)-/),
        )
      }

      // Extraer el número de columnas de la clase activa
      if (claseActiva) {
        const match = claseActiva.match(/col(?:-(?:sm|md|lg|xl))?-(\d+)/)
        if (match) {
          cols = parseInt(match[1])
        }
      }

      // Calcular cuántos slides caben
      return Math.floor(12 / cols)
    },
    mounted() {
      if (this.elements.length && !this.selected) {
        this.selected = this.elements[0].id
      }
      // Opcional: recalcular al cambiar el tamaño de pantalla
      window.addEventListener('resize', this.$forceUpdate)
    },
  },
}
</script>

<style lang="sass">
.slyder-f__btn.is-disabled
  opacity: 0.1
  pointer-events: none
</style>
